#!/usr/bin/env node
var debug = require('debug')('explorer');
var settings = require('../lib/settings');
var db = require('../lib/database');
var app = require('../app');

app.set('port', process.env.PORT || settings.port);

// Promise.all(settings.coin.map(i=>{
//     db.connect(i.name)
// })).then(arrayOfConn =>{
//     // console.log(arrayOfConn);
//     // app.use('/', routes(arrayOfConn));
//     Promise.all(arrayOfConn.map(i => {
//         db.check_stats(i.conn, i.coin).then((exists) =>{
//             if (exists == false) {
//                 console.log('no stats entry found, creating now..');
//                 db.create_stats(i.conn, i.coin).then(()=>{});
//             } else {}
//         });
//         db.check_richlist(i.conn, i.coin).then((exists)=>{
//             if (exists == false) {
//                 console.log('no richlist entry found, creating now..');
//                 db.create_richlist(i.conn, i.coin).then(() =>{});
//             }
//         });
//     })).then(()=>{})
// }).then(()=>{
//     app.listen(app.get('port'), function() {
//         debug('Express server listening on port ' + settings.port);
//     });
// })
module.exports = (data) => {
  db.check_stats(data.conn, data.coin).then((exists) =>{
    if (exists == false) {
      console.log('no stats entry found, creating now..');
      db.create_stats(data.conn, data.coin).then(()=>{});
    } else {}
  });
  db.check_richlist(data.conn, data.coin).then((exists)=>{
    if (exists == false) {
      console.log('no richlist entry found, creating now..');
      db.create_richlist(data.conn, data.coin).then(() =>{});
    }
  });
}

